{% extends "base.html" %}

{% block title %}Study - Flash Card Generation{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-body">
        <h1 class="card-title mb-4">
            <i class="fas fa-book-reader text-primary me-2"></i>Study Mode
        </h1>
        <p class="lead">Review your flashcards to enhance your learning</p>
    </div>
</div>

{% if flashcards %}
<div class="row justify-content-center mb-5">
    <div class="col-12">
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Flashcards</h4>
                <div>
                    <button id="shuffle-btn" class="btn btn-light btn-sm">
                        <i class="fas fa-random me-1"></i> Shuffle
                    </button>
                    <div class="btn-group ms-2">
                        <button id="prev-btn" class="btn btn-light btn-sm">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button id="next-btn" class="btn btn-light btn-sm">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div id="flashcard-container" class="p-5">
                    <!-- Flashcard content will be inserted here by JavaScript -->
                </div>
            </div>
            <div class="card-footer bg-light d-flex justify-content-between align-items-center">
                <span>Card <span id="current-card">1</span> of <span id="total-cards">{{ flashcards|length }}</span></span>
                <div class="btn-group">
                    <button id="show-answer-btn" class="btn btn-primary">
                        <i class="fas fa-eye me-1"></i> Show Answer
                    </button>
                    <button id="hide-answer-btn" class="btn btn-secondary" style="display: none;">
                        <i class="fas fa-eye-slash me-1"></i> Hide Answer
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="alert alert-info" role="alert">
    <i class="fas fa-info-circle me-2"></i>You don't have any flashcards to study. 
    <a href="/create" class="alert-link">Create your first flashcard</a>.
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // Flashcard data
        const flashcards = {{ flashcards|tojson }};
        let currentCardIndex = 0;
        let showingAnswer = false;
        
        // Initial render
        if (flashcards.length > 0) {
            renderCard(currentCardIndex);
        }
        
        // Functions to manage the flashcard display
        function renderCard(index) {
            const card = flashcards[index];
            $('#current-card').text(index + 1);
            
            let html = `
                <div class="flashcard">
                    <div class="flashcard-front">
                        <h1 class="text-center display-4 mb-3">${card.word}</h1>
                        <p class="text-center text-muted fs-5">${card.language}</p>
                    </div>
                    <div class="flashcard-back" style="display: none;">
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2"><i class="fas fa-volume-up text-primary me-2"></i>Pronunciation:</h5>
                            <p class="fs-5 ps-3">${card.pronunciation || 'Not available'}</p>
                        </div>
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2"><i class="fas fa-language text-primary me-2"></i>Translations:</h5>
                            <p class="fs-5 ps-3">${card.translations || 'Not available'}</p>
                        </div>
                        <div>
                            <h5 class="border-bottom pb-2"><i class="fas fa-quote-left text-primary me-2"></i>Examples:</h5>
                            <ul class="list-group list-group-flush">`;
            
            if (card.examples) {
                const examples = card.examples.split(';');
                examples.forEach(example => {
                    if (example.trim()) {
                        html += `<li class="list-group-item fs-5 ps-3">${example.trim()}</li>`;
                    }
                });
            } else {
                html += `<li class="list-group-item">No examples available</li>`;
            }
            
            html += `
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            $('#flashcard-container').html(html);
            showingAnswer = false;
            $('#show-answer-btn').show();
            $('#hide-answer-btn').hide();
        }
        
        // Button event handlers
        $('#next-btn').click(function() {
            if (flashcards.length === 0) return;
            
            currentCardIndex = (currentCardIndex + 1) % flashcards.length;
            renderCard(currentCardIndex);
        });
        
        $('#prev-btn').click(function() {
            if (flashcards.length === 0) return;
            
            currentCardIndex = (currentCardIndex - 1 + flashcards.length) % flashcards.length;
            renderCard(currentCardIndex);
        });
        
        $('#shuffle-btn').click(function() {
            if (flashcards.length <= 1) return;
            
            // Fisher-Yates shuffle algorithm
            for (let i = flashcards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [flashcards[i], flashcards[j]] = [flashcards[j], flashcards[i]];
            }
            
            currentCardIndex = 0;
            renderCard(currentCardIndex);
        });
        
        $('#show-answer-btn').click(function() {
            $('.flashcard-back').show();
            $(this).hide();
            $('#hide-answer-btn').show();
            showingAnswer = true;
        });
        
        $('#hide-answer-btn').click(function() {
            $('.flashcard-back').hide();
            $(this).hide();
            $('#show-answer-btn').show();
            showingAnswer = false;
        });
    });
</script>
{% endblock %} 