{% extends "base.html" %}

{% block title %}Study Flashcards - StudyWAI{% endblock %}

{% block head %}
<style>
    .flashcard-container {
        height: 400px;
        perspective: 1000px;
        margin-bottom: 2rem;
    }
    
    .flashcard-wrapper {
        width: 100%;
        height: 100%;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.8s ease;
    }
    
    .flashcard-wrapper.flipped {
        transform: rotateY(180deg);
    }
    
    .flashcard-side {
        width: 100%;
        height: 100%;
        position: absolute;
        backface-visibility: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        overflow: auto;
    }
    
    .flashcard-front {
        background: linear-gradient(145deg, #ffffff, #f5f5f5);
        z-index: 2;
    }
    
    .flashcard-back {
        background: linear-gradient(145deg, #f8f9fa, #e9ecef);
        transform: rotateY(180deg);
        z-index: 1;
    }
    
    .flashcard-content {
        max-width: 100%;
        overflow: auto;
    }
    
    .flashcard-question {
        font-size: 1.5rem;
        font-weight: 500;
        color: #212529;
        text-align: center;
    }
    
    .flashcard-answer {
        font-size: 1.25rem;
        color: #343a40;
    }
    
    .study-controls {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1rem;
    }

    /* Custom animations */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    .highlight-btn {
        animation: pulse 1s infinite;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="display-5 mb-0">
                    <i class="bi bi-book text-primary me-2"></i> Study Flashcards
                </h1>
                <a href="{{ url_for('home') }}" class="btn btn-outline-primary">
                    <i class="bi bi-arrow-left"></i> Back to List
                </a>
            </div>
            <hr>
        </div>
    </div>

    {% if flashcards|length == 0 %}
    <div class="row">
        <div class="col-12">
            <div class="ai-tool-container text-center py-5">
                <i class="bi bi-emoji-smile fs-1 text-muted mb-3"></i>
                <h3>No flashcards to study yet</h3>
                <p class="text-muted">Create some flashcards first to start studying.</p>
                <a href="{{ url_for('create_get') }}" class="btn btn-primary mt-3">
                    <i class="bi bi-plus-lg"></i> Create Flashcards
                </a>
            </div>
        </div>
    </div>
    {% else %}
    <div class="row">
        <div class="col-12">
            <div class="card-counter text-center mb-4">
                <span class="badge bg-primary p-2">Card <span id="currentCard">1</span> of {{ flashcards|length }}</span>
            </div>
        </div>
    </div>
    
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="flip-card-container">
                <div class="flip-card" id="flashcardElement">
                    <div class="flip-card-front" id="cardFront">
                        <span class="badge bg-light text-primary position-absolute top-0 end-0 m-3">
                            <i class="bi bi-hand-index-thumb"></i> Click to flip
                        </span>
                        <div class="flip-card-word">{{ flashcards[0].word }}</div>
                        <div class="flip-card-pronunciation">{{ flashcards[0].pronunciation or "No pronunciation available" }}</div>
                        <div class="mt-auto">
                            <div class="small text-light opacity-75">Click to reveal translations and examples</div>
                        </div>
                    </div>
                    <div class="flip-card-back" id="cardBack">
                        <div class="w-100">
                            <h4 class="mb-3 text-primary">Translations</h4>
                            <div class="flashcard-translations mb-4">
                                {% if flashcards[0].translations %}
                                    {% for translation in flashcards[0].translations.split(',') %}
                                        <span class="translation-tag">{{ translation.strip() }}</span>
                                    {% endfor %}
                                {% else %}
                                    <span class="translation-tag">No translations available</span>
                                {% endif %}
                            </div>
                            
                            <h4 class="mb-2 text-primary">Examples</h4>
                            <div class="flashcard-examples">
                                {% if flashcards[0].examples %}
                                    {% for example in flashcards[0].examples.split('\n') %}
                                        {% if example.strip() %}
                                            <div class="example-item">{{ example.strip() }}</div>
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <div class="example-item">No examples available</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="text-center my-3">
                <p>How well did you know this?</p>
                <button class="difficulty-btn easy" onclick="markDifficulty('easy')">
                    <i class="bi bi-emoji-smile"></i> Easy
                </button>
                <button class="difficulty-btn medium" onclick="markDifficulty('medium')">
                    <i class="bi bi-emoji-neutral"></i> Medium
                </button>
                <button class="difficulty-btn hard" onclick="markDifficulty('hard')">
                    <i class="bi bi-emoji-frown"></i> Hard
                </button>
            </div>

            <div class="card mt-4 mb-4 bg-white">
                <div class="card-body">
                    <h5 class="card-title">Study Progress</h5>
                    <div class="progress mb-3">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 0%" id="easyProgress">
                            <span id="easyCount">0</span>
                        </div>
                    </div>
                    <div class="progress mb-3">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 0%" id="mediumProgress">
                            <span id="mediumCount">0</span>
                        </div>
                    </div>
                    <div class="progress mb-3">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: 0%" id="hardProgress">
                            <span id="hardCount">0</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between small text-muted">
                        <div>
                            <i class="bi bi-emoji-smile text-success"></i> Easy: <span id="easyLabel">0</span>
                        </div>
                        <div>
                            <i class="bi bi-emoji-neutral text-warning"></i> Medium: <span id="mediumLabel">0</span>
                        </div>
                        <div>
                            <i class="bi bi-emoji-frown text-danger"></i> Hard: <span id="hardLabel">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between mt-4">
                <button class="btn btn-outline-secondary" id="prevBtn" disabled>
                    <i class="bi bi-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="nextBtn">
                    Next <i class="bi bi-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const flashcards = {{ flashcards|tojson }};
    let currentIndex = 0;
    let progress = {
        easy: 0,
        medium: 0,
        hard: 0
    };
    
    const flashcardElement = document.getElementById('flashcardElement');
    const cardFront = document.getElementById('cardFront');
    const cardBack = document.getElementById('cardBack');
    const currentCardElement = document.getElementById('currentCard');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    if (flashcards.length === 0) {
        return;
    }
    
    // Flip card when clicked
    if (flashcardElement) {
        flashcardElement.addEventListener('click', function() {
            flashcardElement.classList.toggle('flipped');
        });
    }
    
    // Handle navigation
    if (prevBtn) {
        prevBtn.addEventListener('click', function() {
            if (currentIndex > 0) {
                currentIndex--;
                updateCard();
            }
        });
    }
    
    if (nextBtn) {
        nextBtn.addEventListener('click', function() {
            if (currentIndex < flashcards.length - 1) {
                currentIndex++;
                updateCard();
            }
        });
    }
    
    // Mark difficulty function
    window.markDifficulty = function(difficulty) {
        progress[difficulty]++;
        updateProgress();
        
        // Automatically go to next card if not the last one
        if (currentIndex < flashcards.length - 1) {
            setTimeout(() => {
                currentIndex++;
                updateCard();
            }, 500);
        }
    };
    
    function updateCard() {
        const flashcard = flashcards[currentIndex];
        
        // Make sure the card is showing the front side when changing cards
        flashcardElement.classList.remove('flipped');
        
        // Update front of card
        cardFront.querySelector('.flip-card-word').textContent = flashcard.word;
        cardFront.querySelector('.flip-card-pronunciation').textContent = 
            flashcard.pronunciation || "No pronunciation available";
        
        // Update back of card
        const translationsContainer = cardBack.querySelector('.flashcard-translations');
        translationsContainer.innerHTML = '';
        
        if (flashcard.translations) {
            const translations = flashcard.translations.split(',');
            translations.forEach(translation => {
                if (translation.trim()) {
                    const span = document.createElement('span');
                    span.className = 'translation-tag';
                    span.textContent = translation.trim();
                    translationsContainer.appendChild(span);
                }
            });
        } else {
            const span = document.createElement('span');
            span.className = 'translation-tag';
            span.textContent = 'No translations available';
            translationsContainer.appendChild(span);
        }
        
        const examplesContainer = cardBack.querySelector('.flashcard-examples');
        examplesContainer.innerHTML = '';
        
        if (flashcard.examples) {
            const examples = flashcard.examples.split('\n');
            examples.forEach(example => {
                if (example.trim()) {
                    const div = document.createElement('div');
                    div.className = 'example-item';
                    div.textContent = example.trim();
                    examplesContainer.appendChild(div);
                }
            });
        } else {
            const div = document.createElement('div');
            div.className = 'example-item';
            div.textContent = 'No examples available';
            examplesContainer.appendChild(div);
        }
        
        // Update UI
        currentCardElement.textContent = currentIndex + 1;
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === flashcards.length - 1;
    }
    
    function updateProgress() {
        const total = flashcards.length;
        const easyPercent = (progress.easy / total * 100) || 0;
        const mediumPercent = (progress.medium / total * 100) || 0;
        const hardPercent = (progress.hard / total * 100) || 0;
        
        document.getElementById('easyProgress').style.width = `${easyPercent}%`;
        document.getElementById('mediumProgress').style.width = `${mediumPercent}%`;
        document.getElementById('hardProgress').style.width = `${hardPercent}%`;
        
        document.getElementById('easyCount').textContent = progress.easy;
        document.getElementById('mediumCount').textContent = progress.medium;
        document.getElementById('hardCount').textContent = progress.hard;
        
        document.getElementById('easyLabel').textContent = progress.easy;
        document.getElementById('mediumLabel').textContent = progress.medium;
        document.getElementById('hardLabel').textContent = progress.hard;
    }
    
    // Initial setup
    updateCard();
    updateProgress();
});
</script>
{% endblock %} 